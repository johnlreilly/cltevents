<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Charlotte Events Discovery</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
  <div id="root"></div>
  
  <script type="text/babel">
    const { useState } = React;

    const EventDiscoveryApp = () => {
      const [selectedCategory, setSelectedCategory] = useState('all');
      const [favorites, setFavorites] = useState(() => {
        const saved = localStorage.getItem('cltevents-favorites');
        return saved ? JSON.parse(saved) : [];
      });
      const [hidden, setHidden] = useState(() => {
        const saved = localStorage.getItem('cltevents-hidden');
        return saved ? JSON.parse(saved) : [];
      });
      const today = new Date().toISOString().split('T')[0];
      const [dateRange, setDateRange] = useState({ start: today, end: '' });
      const [priceRange, setPriceRange] = useState({ min: '', max: '' });
      const [showFilters, setShowFilters] = useState(false);
      const [showCategoryMenu, setShowCategoryMenu] = useState(false);
      const [showGenreMenu, setShowGenreMenu] = useState(false);
      const [shareEvent, setShareEvent] = useState(null);
      const [loading, setLoading] = useState(false);
      const [apiEvents, setApiEvents] = useState([]);
      const [lastSync, setLastSync] = useState(null);
      const [sortBy, setSortBy] = useState('date');
      const [initialLoad, setInitialLoad] = useState(true);
      const [expandedDescriptions, setExpandedDescriptions] = useState([]);
      const [availableGenres, setAvailableGenres] = useState([]);
      const [selectedGenres, setSelectedGenres] = useState([]);

      React.useEffect(() => {
        fetchEvents();
      }, []);

      React.useEffect(() => {
        localStorage.setItem('cltevents-favorites', JSON.stringify(favorites));
      }, [favorites]);

      React.useEffect(() => {
        localStorage.setItem('cltevents-hidden', JSON.stringify(hidden));
      }, [hidden]);

      const excludeKeywords = ['bingo', 'trivia', 'drag', 'kids', 'children\'s', 'day party', 'bridal', 'disney', 'comedy'];

      const excludeGenres = ['hip-hop', 'rap', 'french rap', 'metal', 'nu-metal', 'country', 'children\'s theater'];

      const preferredVenues = [
        'neighborhood theater',
        'the fillmore',
        'visulite theater',
        'smokey joe\'s cafe',
        'goldies',
        'amos\' southend',
        'evening muse',
        'pnc music pavilion',
        'skyla credit union',
        'thirsty beaver',
        'snug harbor'
      ];

      const diveBarVenues = [
        'thirsty beaver',
        'snug harbor',
        'smokey joe\'s cafe'
      ];

      const filterEvents = () => {
        let filtered = apiEvents;

        filtered = filtered.filter(event => {
          const searchText = `${event.name} ${event.description}`.toLowerCase();
          return !excludeKeywords.some(keyword => searchText.includes(keyword.toLowerCase()));
        });

        // Filter out excluded genres
        filtered = filtered.filter(event => {
          if (!event.genres || event.genres.length === 0) return true;
          return !event.genres.some(genre =>
            excludeGenres.some(excluded => genre.toLowerCase() === excluded.toLowerCase())
          );
        });

        if (selectedGenres.length > 0) {
          filtered = filtered.filter(event =>
            event.genres && event.genres.some(genre => selectedGenres.includes(genre))
          );
        }

        const now = new Date();
        filtered = filtered.filter(e => {
          const eventDate = new Date(e.date);
          return eventDate >= now || eventDate.toDateString() === now.toDateString();
        });

        if (selectedCategory === 'hidden') {
          filtered = filtered.filter(e => hidden.includes(e.name.toLowerCase().trim()));
        } else {
          // Exclude hidden events from all other views
          filtered = filtered.filter(e => !hidden.includes(e.name.toLowerCase().trim()));

          if (selectedCategory !== 'all') {
            if (selectedCategory === 'favorites') {
              filtered = filtered.filter(e => favorites.includes(e.id));
            } else if (selectedCategory === 'divebars') {
              filtered = filtered.filter(e =>
                diveBarVenues.some(venue => e.venue.toLowerCase().includes(venue))
              );
            } else {
              filtered = filtered.filter(e => e.type === selectedCategory);
            }
          }
        }

        if (dateRange.start) {
          filtered = filtered.filter(e => e.date >= dateRange.start);
        }
        if (dateRange.end) {
          filtered = filtered.filter(e => e.date <= dateRange.end);
        }

        if (priceRange.min) {
          filtered = filtered.filter(e => e.price >= Number(priceRange.min));
        }
        if (priceRange.max) {
          filtered = filtered.filter(e => e.price <= Number(priceRange.max));
        }

        return filtered;
      };

      const groupEventsByName = (events) => {
        const grouped = {};

        events.forEach(event => {
          if (!event || !event.name || !event.date) return;

          // Remove text in parentheses and normalize for grouping
          const baseName = event.name.replace(/\s*\([^)]*\)/g, '').toLowerCase().trim();
          const key = baseName;

          if (!grouped[key]) {
            grouped[key] = {
              ...event,
              name: event.name.replace(/\s*\([^)]*\)/g, '').trim(), // Use base name without parentheses
              dates: [{ date: event.date, id: event.id, ticketUrl: event.ticketUrl }]
            };
          } else {
            grouped[key].dates.push({ date: event.date, id: event.id, ticketUrl: event.ticketUrl });
          }
        });

        return Object.values(grouped).map(event => ({
          ...event,
          dates: event.dates.sort((a, b) => new Date(a.date) - new Date(b.date))
        }));
      };

      const sortEvents = (events) => {
        return [...events].sort((a, b) => {
          if (sortBy === 'date') {
            const dateCompare = new Date(a.dates[0].date) - new Date(b.dates[0].date);
            if (dateCompare !== 0) return dateCompare;
            
            const aVenueBoost = preferredVenues.some(v => a.venue.toLowerCase().includes(v)) ? 10 : 0;
            const bVenueBoost = preferredVenues.some(v => b.venue.toLowerCase().includes(v)) ? 10 : 0;
            const aScore = a.matchScore + aVenueBoost;
            const bScore = b.matchScore + bVenueBoost;
            return bScore - aScore;
          } else {
            const aVenueBoost = preferredVenues.some(v => a.venue.toLowerCase().includes(v)) ? 10 : 0;
            const bVenueBoost = preferredVenues.some(v => b.venue.toLowerCase().includes(v)) ? 10 : 0;
            const aScore = a.matchScore + aVenueBoost;
            const bScore = b.matchScore + bVenueBoost;
            return bScore - aScore;
          }
        });
      };

      const filteredEvents = filterEvents();
      const groupedEvents = groupEventsByName(filteredEvents);
      const sortedEvents = sortEvents(groupedEvents);

      const categories = [
        { id: 'all', name: 'All' },
        { id: 'favorites', name: 'Favorites' },
        { id: 'divebars', name: 'Dive Bars' },
        { id: 'music', name: 'Music' },
        { id: 'sports', name: 'Sports' },
        { id: 'food', name: 'Food & Drink' },
        { id: 'hidden', name: 'Hidden' }
      ];

      const toggleFavorite = (eventId) => {
        setFavorites(prev =>
          prev.includes(eventId)
            ? prev.filter(id => id !== eventId)
            : [...prev, eventId]
        );
      };

      const toggleHidden = (event) => {
        const eventKey = event.name.toLowerCase().trim();
        setHidden(prev =>
          prev.includes(eventKey)
            ? prev.filter(key => key !== eventKey)
            : [...prev, eventKey]
        );
      };

      const toggleDescription = (eventId) => {
        setExpandedDescriptions(prev =>
          prev.includes(eventId)
            ? prev.filter(id => id !== eventId)
            : [...prev, eventId]
        );
      };

      const formatDate = (dateStr) => {
        const date = new Date(dateStr);
        return date.toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' });
      };

      const getMatchColor = (score) => {
        if (score >= 85) return 'text-green-600 bg-green-50';
        if (score >= 70) return 'text-blue-600 bg-blue-50';
        return 'text-gray-600 bg-gray-50';
      };

      const isPreferredVenue = (venue) => {
        return preferredVenues.some(v => venue.toLowerCase().includes(v));
      };

      const hasUsefulDescription = (event) => {
        if (!event.description) return false;
        const desc = event.description.trim().toLowerCase();
        const name = event.name.trim().toLowerCase();
        const venue = event.venue.trim().toLowerCase();

        // Hide if description is the same as the event name
        if (desc === name) return false;

        // Hide if description only contains venue information
        if (desc === venue || desc.includes(venue) && desc.length < venue.length + 20) return false;

        return true;
      };

      const handleShare = (event) => {
        setShareEvent(event);
        setTimeout(() => setShareEvent(null), 3000);
        
        const shareText = `Check out ${event.name} at ${event.venue} on ${formatDate(event.dates[0].date)}! Only $${event.price}`;
        navigator.clipboard.writeText(shareText);
      };

      const clearFilters = () => {
        setDateRange({ start: today, end: '' });
        setPriceRange({ min: '', max: '' });
        setSelectedGenres([]);
      };

      const toggleGenre = (genre) => {
        setSelectedGenres(prev =>
          prev.includes(genre)
            ? prev.filter(g => g !== genre)
            : [...prev, genre]
        );
      };

      const fetchEvents = async () => {
        setLoading(true);
        try {
          // Fetch from both Ticketmaster and Smokey Joe's in parallel
          const [ticketmasterResponse, smokeyJoesResponse] = await Promise.all([
            fetch('/api/events'),
            fetch('/api/smokeyjoes')
          ]);

          let allEvents = [];

          // Process Ticketmaster events
          if (ticketmasterResponse.ok) {
            const tmData = await ticketmasterResponse.json();
            
            const tmEvents = await Promise.all(tmData.events.map(async (tmEvent) => {
              let eventType = 'other';
              const classification = tmEvent.classifications?.[0];
              const segment = classification?.segment?.name?.toLowerCase() || '';
              const genre = classification?.genre?.name?.toLowerCase() || '';
              
              const genres = [];
              if (classification?.segment?.name && classification.segment.name !== 'Undefined') {
                genres.push(classification.segment.name);
              }
              if (classification?.genre?.name && classification.genre.name !== 'Undefined') {
                genres.push(classification.genre.name);
              }
              if (classification?.subGenre?.name && classification.subGenre.name !== 'Undefined') {
                genres.push(classification.subGenre.name);
              }
              
              if (segment.includes('music') || genre.includes('music')) {
                eventType = 'music';
              } else if (segment.includes('sports')) {
                eventType = 'sports';
              } else if (segment.includes('arts') || segment.includes('theatre')) {
                eventType = 'other';
              }

              let price = 0;
              if (tmEvent.priceRanges && tmEvent.priceRanges.length > 0) {
                price = tmEvent.priceRanges[0].min || 0;
              }

              const venue = tmEvent._embedded?.venues?.[0]?.name || 'Venue TBA';

              let matchScore = 70;
              if (preferredVenues.some(v => venue.toLowerCase().includes(v))) {
                matchScore += 15;
              }
              if (eventType === 'music') {
                matchScore += 10;
              }

              let youtubeLinks = [];
              if (eventType === 'music') {
                youtubeLinks = await fetchYouTubeVideos(tmEvent.name);
              }

              // Extract image URL - prefer high resolution images
              let imageUrl = null;
              if (tmEvent.images && tmEvent.images.length > 0) {
                // Sort by width descending to get highest resolution
                const sortedImages = [...tmEvent.images].sort((a, b) => (b.width || 0) - (a.width || 0));
                imageUrl = sortedImages[0]?.url;
              }

              return {
                id: `tm-${tmEvent.id}`,
                name: tmEvent.name,
                type: eventType,
                date: tmEvent.dates?.start?.localDate || '',
                venue: venue,
                distance: 'N/A',
                description: tmEvent.info || tmEvent.pleaseNote || tmEvent.name,
                price: price,
                youtubeLinks: youtubeLinks.length > 0 ? youtubeLinks : undefined,
                matchScore: Math.min(matchScore, 98),
                ticketUrl: tmEvent.url,
                genres: genres,
                imageUrl: imageUrl,
                source: 'ticketmaster'
              };
            }));
            
            allEvents = [...allEvents, ...tmEvents];
          }

          // Process Smokey Joe's events
          if (smokeyJoesResponse.ok) {
            const sjData = await smokeyJoesResponse.json();
            
            const sjEvents = await Promise.all(sjData.events.map(async (sjEvent) => {
              // All Smokey Joe's events are music
              const eventType = 'music';
              
              // Smokey Joe's is a preferred venue, so give it a boost
              let matchScore = 70 + 15 + 10; // base + venue boost + music boost = 95

              let youtubeLinks = await fetchYouTubeVideos(sjEvent.name);
              
              return {
                id: `sj-${sjEvent.name}-${sjEvent.date}`,
                name: sjEvent.name,
                type: eventType,
                date: sjEvent.date,
                venue: sjEvent.venue,
                distance: 'N/A',
                description: sjEvent.description,
                price: 0, // Smokey Joe's doesn't provide pricing
                youtubeLinks: youtubeLinks.length > 0 ? youtubeLinks : undefined,
                matchScore: matchScore,
                ticketUrl: 'https://smokeyjoes.cafe',
                genres: ['Music', 'Live'],
                source: 'smokeyjoes'
              };
            }));
            
            allEvents = [...allEvents, ...sjEvents];
          }

          setApiEvents(allEvents);
          
          // Extract unique genres for filtering
          const allGenres = new Set();
          allEvents.forEach(event => {
            if (event.genres) {
              event.genres.forEach(genre => allGenres.add(genre));
            }
          });
          setAvailableGenres(Array.from(allGenres).sort());

          setLastSync(new Date());
          setInitialLoad(false);
          if (!initialLoad) {
            alert(`Successfully loaded ${allEvents.length} events from Ticketmaster and Smokey Joe's!`);
          }
        } catch (error) {
          setInitialLoad(false);
          alert(`Error fetching events: ${error.message}`);
          console.error('API Error:', error);
        } finally {
          setLoading(false);
        }
      };

      const fetchYouTubeVideos = async (artistName) => {
        try {
          const response = await fetch(`/api/youtube?query=${encodeURIComponent(artistName)}`);

          if (!response.ok) {
            console.error('YouTube API error:', response.status);
            return [];
          }

          const data = await response.json();
          return data.videos || [];
        } catch (error) {
          console.error('Error fetching YouTube videos:', error);
          return [];
        }
      };

      const hasActiveFilters = dateRange.start || dateRange.end || priceRange.min || priceRange.max || selectedGenres.length > 0;

      if (initialLoad && loading) {
        return (
          <div className="min-h-screen bg-gradient-to-br from-purple-50 to-blue-50 flex items-center justify-center">
            <div className="text-center">
              <div className="mb-4">
                <svg className="animate-spin h-16 w-16 text-purple-600 mx-auto" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                  <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle>
                  <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
              </div>
              <h2 className="text-2xl font-bold text-gray-800 mb-2">Stand by... pulling events...</h2>
              <p className="text-gray-600">Loading events from the webs!</p>
            </div>
          </div>
        );
      }

      return (
        <div className="min-h-screen bg-gradient-to-br from-purple-50 to-blue-50">
          <div className="max-w-6xl mx-auto p-6">
            <div className="mb-6">
              <div className="flex justify-between items-center">
                <h1 className="text-4xl font-bold text-gray-800">CLT</h1>
                <button
                  onClick={fetchEvents}
                  disabled={loading}
                  className="px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700 transition-colors flex items-center gap-2 disabled:bg-gray-400"
                >
                  <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                  </svg>
                  {loading ? 'Loading...' : 'Refresh'}
                </button>
              </div>
            </div>

            <div className="mb-4 flex flex-wrap gap-3">
              <div className="relative flex-1 min-w-[200px]">
                <button
                  onClick={() => setShowCategoryMenu(!showCategoryMenu)}
                  className="flex items-center gap-2 px-6 py-3 bg-white rounded-lg shadow-md hover:shadow-lg transition-all w-full"
                >
                  <span className="font-semibold text-gray-800">
                    {categories.find(cat => cat.id === selectedCategory)?.name || 'All'}
                  </span>
                  <svg className="w-4 h-4 ml-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 9l-7 7-7-7" />
                  </svg>
                </button>

                {showCategoryMenu && (
                  <>
                    <div
                      className="fixed inset-0 bg-black bg-opacity-30 z-40"
                      onClick={() => setShowCategoryMenu(false)}
                    />
                    <div className="absolute top-full left-0 mt-2 w-full bg-white rounded-lg shadow-xl z-50 overflow-hidden">
                      {categories.map(cat => (
                        <button
                          key={cat.id}
                          onClick={() => {
                            setSelectedCategory(cat.id);
                            setShowCategoryMenu(false);
                          }}
                          className={`flex items-center gap-3 px-6 py-4 w-full text-left transition-all ${
                            selectedCategory === cat.id
                              ? 'bg-purple-600 text-white'
                              : cat.id === 'hidden'
                              ? 'text-gray-400 hover:bg-gray-50'
                              : 'text-gray-700 hover:bg-purple-50'
                          }`}
                        >
                          <span className="font-medium">{cat.name}</span>
                          {selectedCategory === cat.id && (
                            <svg className="w-5 h-5 ml-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 13l4 4L19 7" />
                            </svg>
                          )}
                        </button>
                      ))}
                    </div>
                  </>
                )}
              </div>

              <div className="relative flex-1 min-w-[200px]">
                <button
                  onClick={() => setShowGenreMenu(!showGenreMenu)}
                  className="flex items-center gap-2 px-6 py-3 bg-white rounded-lg shadow-md hover:shadow-lg transition-all w-full"
                >
                  <span className="font-semibold text-gray-800">
                    {selectedGenres.length === 0 ? 'All Genres' : `${selectedGenres.length} Genre${selectedGenres.length > 1 ? 's' : ''}`}
                  </span>
                  <svg className="w-4 h-4 ml-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 9l-7 7-7-7" />
                  </svg>
                </button>

                {showGenreMenu && (
                  <>
                    <div
                      className="fixed inset-0 bg-black bg-opacity-30 z-40"
                      onClick={() => setShowGenreMenu(false)}
                    />
                    <div className="absolute top-full left-0 mt-2 w-full bg-white rounded-lg shadow-xl z-50 max-h-96 overflow-y-auto">
                      {selectedGenres.length > 0 && (
                        <button
                          onClick={() => setSelectedGenres([])}
                          className="flex items-center gap-3 px-6 py-3 w-full text-left border-b border-gray-200 text-purple-600 hover:bg-purple-50 font-medium"
                        >
                          Clear All
                        </button>
                      )}
                      {availableGenres.map(genre => (
                        <button
                          key={genre}
                          onClick={() => {
                            setSelectedGenres(prev =>
                              prev.includes(genre)
                                ? prev.filter(g => g !== genre)
                                : [...prev, genre]
                            );
                          }}
                          className="flex items-center gap-3 px-6 py-3 w-full text-left transition-all text-gray-700 hover:bg-purple-50"
                        >
                          <div className={`w-5 h-5 rounded border-2 flex items-center justify-center ${
                            selectedGenres.includes(genre)
                              ? 'bg-purple-600 border-purple-600'
                              : 'border-gray-300'
                          }`}>
                            {selectedGenres.includes(genre) && (
                              <svg className="w-3 h-3 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={3} d="M5 13l4 4L19 7" />
                              </svg>
                            )}
                          </div>
                          <span className="font-medium">{genre}</span>
                        </button>
                      ))}
                    </div>
                  </>
                )}
              </div>
            </div>

            <div className="flex justify-between items-center mb-4">
              <button
                onClick={() => setShowFilters(!showFilters)}
                className="flex items-center gap-2 px-4 py-2 bg-white rounded-lg shadow hover:shadow-md transition-all"
              >
                <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z" />
                </svg>
                Filters
                {hasActiveFilters && (
                  <span className="bg-purple-600 text-white text-xs px-2 py-1 rounded-full">Active</span>
                )}
              </button>

              <div className="bg-white rounded-lg shadow p-1 flex gap-1">
                <button
                  onClick={() => setSortBy('date')}
                  className={`px-4 py-2 rounded-md text-sm font-medium transition-all ${
                    sortBy === 'date'
                      ? 'bg-purple-600 text-white'
                      : 'text-gray-600 hover:text-gray-800'
                  }`}
                >
                  📅 Date
                </button>
                <button
                  onClick={() => setSortBy('match')}
                  className={`px-4 py-2 rounded-md text-sm font-medium transition-all ${
                    sortBy === 'match'
                      ? 'bg-purple-600 text-white'
                      : 'text-gray-600 hover:text-gray-800'
                  }`}
                >
                  ⭐ Best
                </button>
              </div>
            </div>

            <div className="mb-6">

              {showFilters && (
                <div className="mt-4 p-6 bg-white rounded-lg shadow-lg">
                  <div className="grid md:grid-cols-2 gap-6">
                    <div>
                      <label className="block text-sm font-semibold text-gray-700 mb-2">Date Range</label>
                      <div className="flex gap-2">
                        <input
                          type="date"
                          value={dateRange.start}
                          onChange={(e) => setDateRange({...dateRange, start: e.target.value})}
                          className="flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                        />
                        <span className="flex items-center text-gray-500">to</span>
                        <input
                          type="date"
                          value={dateRange.end}
                          onChange={(e) => setDateRange({...dateRange, end: e.target.value})}
                          className="flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                        />
                      </div>
                    </div>

                    <div>
                      <label className="block text-sm font-semibold text-gray-700 mb-2">Price Range ($)</label>
                      <div className="flex gap-2">
                        <input
                          type="number"
                          placeholder="Min"
                          value={priceRange.min}
                          onChange={(e) => setPriceRange({...priceRange, min: e.target.value})}
                          className="flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                        />
                        <span className="flex items-center text-gray-500">to</span>
                        <input
                          type="number"
                          placeholder="Max"
                          value={priceRange.max}
                          onChange={(e) => setPriceRange({...priceRange, max: e.target.value})}
                          className="flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                        />
                      </div>
                    </div>
                  </div>

                  {availableGenres.length > 0 && (
                    <div className="mt-6">
                      <label className="block text-sm font-semibold text-gray-700 mb-2">
                        Filter by Genre/Type ({selectedGenres.length} selected)
                      </label>
                      <div className="flex flex-wrap gap-2 max-h-60 overflow-y-auto p-2 bg-gray-50 rounded-lg">
                        {availableGenres.map(genre => (
                          <button
                            key={genre}
                            onClick={() => toggleGenre(genre)}
                            className={`px-3 py-1 rounded-full text-sm transition-all ${
                              selectedGenres.includes(genre)
                                ? 'bg-purple-600 text-white'
                                : 'bg-white text-gray-700 border border-gray-300 hover:border-purple-400'
                            }`}
                          >
                            {genre}
                          </button>
                        ))}
                      </div>
                    </div>
                  )}

                  {hasActiveFilters && (
                    <button
                      onClick={clearFilters}
                      className="mt-4 flex items-center gap-2 text-sm text-purple-600 hover:text-purple-700"
                    >
                      Clear All Filters
                    </button>
                  )}
                </div>
              )}
            </div>

            <div className="mb-4 text-sm text-gray-600">
              Showing {sortedEvents.length} events
              {apiEvents.length > 0 && (
                <span className="ml-2 text-orange-600 font-semibold">
                  (From Ticketmaster & Local Venues)
                </span>
              )}
            </div>

            <div className="grid md:grid-cols-2 gap-6">
              {sortedEvents.map(event => (
                <div key={event.id} className="bg-white rounded-xl shadow-md overflow-hidden hover:shadow-xl transition-shadow">
                  <div className="p-6">
                    <div className="flex justify-between items-start mb-3">
                      <div className="flex-1">
                        <h3 className="text-xl font-bold text-gray-800 mb-1">{event.name}</h3>
                        <div className="flex items-center gap-2">
                          <p className="text-sm text-gray-600">{event.venue}</p>
                          {isPreferredVenue(event.venue) && (
                            <span className="text-xs bg-purple-100 text-purple-700 px-2 py-1 rounded-full font-semibold">
                              Top Venue
                            </span>
                          )}
                        </div>
                      </div>
                      <div className="flex gap-2 ml-4">
                        <button
                          onClick={() => toggleFavorite(event.id)}
                          title="Favorite"
                        >
                          <svg
                            className={`w-6 h-6 ${favorites.includes(event.id) ? 'fill-red-500 text-red-500' : 'text-gray-300'}`}
                            fill={favorites.includes(event.id) ? 'currentColor' : 'none'}
                            stroke="currentColor"
                            viewBox="0 0 24 24"
                          >
                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" />
                          </svg>
                        </button>
                        <button
                          onClick={() => toggleHidden(event)}
                          title="Hide event"
                          className="hover:bg-gray-100 rounded-full p-1 transition-colors"
                        >
                          <svg
                            className={`w-5 h-5 ${hidden.includes(event.name.toLowerCase().trim()) ? 'text-red-600' : 'text-gray-400 hover:text-gray-600'}`}
                            fill="none"
                            stroke="currentColor"
                            viewBox="0 0 24 24"
                          >
                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
                          </svg>
                        </button>
                      </div>
                    </div>

                    <div className="flex items-center gap-4 mb-3 text-sm text-gray-600">
                      <span className="flex items-center gap-1">
                        <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                        </svg>
                        {event.dates.length > 1 ? `${event.dates.length} dates` : formatDate(event.dates[0].date)}
                      </span>
                      <span className="flex items-center gap-1">
                        <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
                        </svg>
                        {event.distance}
                      </span>
                      <span className="flex items-center gap-1 font-semibold text-green-700">
                        <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                        ${event.price}
                      </span>
                    </div>

                    {event.dates.length > 1 && (
                      <div className="mb-4 p-3 bg-blue-50 rounded-lg">
                        <div className="text-sm font-semibold text-blue-900 mb-2">Available Dates:</div>
                        <div className="space-y-1">
                          {event.dates.map((dateInfo, idx) => (
                            <div key={idx} className="flex items-center justify-between text-sm">
                              <span className="text-blue-700">{formatDate(dateInfo.date)}</span>
                              {dateInfo.ticketUrl && (
                                <a
                                  href={dateInfo.ticketUrl}
                                  target="_blank"
                                  rel="noopener noreferrer"
                                  className="text-blue-600 hover:text-blue-800 text-xs underline"
                                >
                                  Tickets
                                </a>
                              )}
                            </div>
                          ))}
                        </div>
                      </div>
                    )}

                    {event.genres && event.genres.length > 0 && (
                      <div className="mb-4 flex flex-wrap gap-2">
                        {event.genres.map((genre, idx) => (
                          <span key={idx} className="text-xs bg-gray-100 text-gray-700 px-2 py-1 rounded-full">
                            {genre}
                          </span>
                        ))}
                      </div>
                    )}

                    {event.imageUrl && (
                      <div className="mb-4 -mx-6">
                        <img
                          src={event.imageUrl}
                          alt={event.name}
                          className="w-full h-[20vh] object-cover"
                        />
                      </div>
                    )}

                    {hasUsefulDescription(event) && (
                      <>
                        {expandedDescriptions.includes(event.id) && (
                          <p className="text-gray-700 mb-4">{event.description}</p>
                        )}

                        <button
                          onClick={() => toggleDescription(event.id)}
                          className="text-sm text-purple-600 hover:text-purple-700 mb-4"
                        >
                          {expandedDescriptions.includes(event.id) ? '▲ Hide Description' : '▼ Show Description'}
                        </button>
                      </>
                    )}

                    {event.youtubeLinks && event.youtubeLinks.length > 0 && (
                      <div className="mb-4 p-3 bg-red-50 rounded-lg">
                        <div className="flex items-center gap-2 mb-2 text-sm font-semibold text-red-700">
                          <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3" />
                          </svg>
                          Listen on YouTube
                        </div>
                        <div className="space-y-2">
                          {event.youtubeLinks.map((link, idx) => (
                            <a
                              key={idx}
                              href={link.url}
                              target="_blank"
                              rel="noopener noreferrer"
                              className="flex items-center gap-2 text-sm text-blue-600 hover:text-blue-800 hover:underline"
                            >
                              <svg className="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
                              </svg>
                              {link.title}
                            </a>
                          ))}
                        </div>
                      </div>
                    )}

                    <div className="flex items-center justify-between">
                      <span className={`px-3 py-1 rounded-full text-sm font-semibold ${getMatchColor(event.matchScore)}`}>
                        {event.matchScore}% Match
                      </span>
                      <div className="flex gap-2">
                        <button
                          onClick={() => handleShare(event)}
                          className="p-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors"
                          title="Share event"
                        >
                          <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z" />
                          </svg>
                        </button>
                        {event.ticketUrl ? (
                          <a
                            href={event.ticketUrl}
                            target="_blank"
                            rel="noopener noreferrer"
                            className="px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors inline-block"
                          >
                            Get Tickets
                          </a>
                        ) : event.dates.length === 1 && event.dates[0].ticketUrl ? (
                          <a
                            href={event.dates[0].ticketUrl}
                            target="_blank"
                            rel="noopener noreferrer"
                            className="px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors inline-block"
                          >
                            Get Tickets
                          </a>
                        ) : (
                          <button className="px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors">
                            Get Tickets
                          </button>
                        )}
                      </div>
                    </div>
                  </div>
                </div>
              ))}
            </div>

            {sortedEvents.length === 0 && (
              <div className="text-center py-12">
                <p className="text-gray-500 text-lg">No events found matching your filters.</p>
                {hasActiveFilters && (
                  <button
                    onClick={clearFilters}
                    className="mt-4 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700"
                  >
                    Clear Filters
                  </button>
                )}
              </div>
            )}
          </div>

          {shareEvent && (
            <div className="fixed bottom-6 right-6 bg-green-600 text-white px-6 py-3 rounded-lg shadow-lg flex items-center gap-2">
              <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z" />
              </svg>
              Event details copied to clipboard!
            </div>
          )}
        </div>
      );
    };

    ReactDOM.render(<EventDiscoveryApp />, document.getElementById('root'));
  </script>
</body>
</html>